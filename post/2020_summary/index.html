<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>2020总结 - uks&#39;s blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="ukeeysdis" />
  <meta name="description" content="已经很久没有写博客了，上一次应该18年9月对秋招结束的一个总结（因为工作之后太懒：） 不管是在工作中还是平时收获的东西，还是应当像之前在学校一" />







<meta name="generator" content="Hugo 0.79.0" />


<link rel="canonical" href="http://ukeeysdis.github.io/post/2020_summary/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.f1e506a781bf25d33ffc18aa6b4e972a965c58049d27d4f92b7db2e9bf28e4bf.css" integrity="sha256-8eUGp4G/JdM//Biqa06XKpZcWASdJ9T5K32y6b8o5L8=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="2020总结" />
<meta property="og:description" content="已经很久没有写博客了，上一次应该18年9月对秋招结束的一个总结（因为工作之后太懒：） 不管是在工作中还是平时收获的东西，还是应当像之前在学校一" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://ukeeysdis.github.io/post/2020_summary/" />
<meta property="article:published_time" content="2021-01-03T15:51:15+08:00" />
<meta property="article:modified_time" content="2021-01-03T15:51:15+08:00" />
<meta itemprop="name" content="2020总结">
<meta itemprop="description" content="已经很久没有写博客了，上一次应该18年9月对秋招结束的一个总结（因为工作之后太懒：） 不管是在工作中还是平时收获的东西，还是应当像之前在学校一">
<meta itemprop="datePublished" content="2021-01-03T15:51:15+08:00" />
<meta itemprop="dateModified" content="2021-01-03T15:51:15+08:00" />
<meta itemprop="wordCount" content="2668">



<meta itemprop="keywords" content="总结," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="2020总结"/>
<meta name="twitter:description" content="已经很久没有写博客了，上一次应该18年9月对秋招结束的一个总结（因为工作之后太懒：） 不管是在工作中还是平时收获的东西，还是应当像之前在学校一"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">uks's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/categories/">种类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/about/">关于</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      uks's blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/categories/">种类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://ukeeysdis.github.io/about/">关于</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">2020总结</h1>
      
      <div class="post-meta">
        <time datetime="2021-01-03" class="post-time">
          2021-01-03
        </time>
        <div class="post-category">
            <a href="http://ukeeysdis.github.io/categories/%E4%B8%AA%E4%BA%BA%E6%84%9F%E6%82%9F/"> 个人感悟 </a>
            
          </div>
        <span class="more-meta"> 约 2668 字 </span>
          <span class="more-meta"> 预计阅读 6 分钟 </span>

        
        

        
        
          <span id="/post/2020_summary/" class="leancloud_visitors" data-flag-title="2020总结">
            <span class="post-meta-item-text"> | 阅读 </span>
            <span class="leancloud-visitors-count"></span>
          </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#实习">实习</a></li>
        <li><a href="#正式入职">正式入职</a></li>
        <li><a href="#总结">总结</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>已经很久没有写博客了，上一次应该18年9月对秋招结束的一个总结（因为工作之后太懒：）</p>
<p>不管是在工作中还是平时收获的东西，还是应当像之前在学校一样花时间记录下来，不然很容易就忘记了，等下次再遇到，又得花时间重新收集资料，如此反复。</p>
<p>这篇文章仅记录一下在此之前我的一些生活以及工作历程，就当是对之前的一个大总结了。</p>
<h3 id="实习">实习</h3>
<p>当时在北京实习完后，毕业前回到成都，在学校待着，迫于生计，又找了一个实习，是一家做大数据安全的小公司（现在已经被收购），工作内容和之前在百度实习的时候类似，是做流式计算相关的东西，带我的人让我去预研一个计算相关的组件（叫啥忘了），我只实习了一个月就走了，因为预研实在是难受，每天坐在那里看论文，完全没有融入感，加上实习工资也比较低。
这段经历让我明白两点：</p>
<ol>
<li>小公司可能因为用到开源组件更多一些，对新技术的接受程度其实更高，历史包袱没有那么重，比如他们已经开始使用Rust，并且尝试使用业界比较前沿的大数据计算组件</li>
<li>早9晚6真的很舒服：）</li>
</ol>
<p>随后，我联系了校招的面试官，能否在成都腾讯提前实习一段时间，能够提前熟悉一下工作内容，并且恰好也在成都。</p>
<p>在一番协商后，我在成都腾讯入职了。</p>
<p>因为是实习的缘故，所以工作没有那么多，主要还是熟悉一些开发环境然后做一下不太重要的小需求。当时工作中也问了导师的不少问题，大多都跟工作环境相关的，不过说实话他不是很友好。后来因为做的工作内容和心理预期不太符合，再加上待着比较难受，就联系了另外的团队，简单聊了一下，最后更换了入职的组。（及时止损很重要，其实觉得挺对不起原leader，他人挺好</p>
<h3 id="正式入职">正式入职</h3>
<p>毕业后，我在广州腾讯正式入职了，女朋友也找到了实习，不过是在深圳腾讯，所以我每周五得坐最后一趟班车去深圳，然后周一再坐最早的班车回广州。
工作上面因为之前实习了一段时间，以及毕业设计是跟libco协程相关的，所以对环境有了一定的熟悉度，入职的前两周应导师的安排，阅读了微信用的rpc框架源码（因为随后工作中会大量使用），并且总结成了pdf发到组里（这一点是导师要求的，因为这也是个人输出的一部分，他的原话大意是花了时间，一定要让老大看到你做了什么，有产出才行）。他也给我安排了随后的一些学习计划，不过是在工作中进行，比如阅读phxpaxos以及phxqueue的源码，业务和组件两条腿走路。（不过即使到现在，这两个组件的源码我还是没有开始染指，囧）</p>
<p>微信后台有不少沉淀的优秀资料与组件以及架构，在这过程中：</p>
<ol>
<li>
<p>在分布式方面，我熟悉了分布式相关的原理以及一些常见的分布式算法，比如事务相关的，常见的2PC、3PC、消息表、TCC以及事务消息，副本的一致性，Quorum算法，阅读了raft和paxos的论文，raft其实之前在毕业之前就做过6.824的课程，但忘的太厉害。paxos目前在微信后台大量使用，特别是存储，基于phxpaxos实现了强一致的kv，是微信的基石。选主需要用的租约机制，数据路由需要用到的一致性hash等算法。</p>
<p>这里比较推荐刘杰的《分布式系统原理介绍》这个PDF以及《数据密集型应用系统设计》这本书。了解这些原理固然需要时间，但运用这些算法去完成一个能解决实际问题的项目，这才是最难的。我们如果没有实际的项目，其实很难完全掌握这些算法，不过也可以退而求次，有机会的话去阅读一些源码，比如paxos，它的原理以及证明在掌握了之后，真实用在工程中，会存在性能问题，phxpaxos就是在针对basic paxos优化之后的产物。</p>
<p>RPC方面就主要是微信自研的，整体是一个mutli-reactors，其中大量使用了libco协程，libco是把网络相关的系统调用进行了hook实现的协程，rpc的请求路由一般采用一致性hash实现，这样可以让同一个用户的请求尽量到同一台机器，便于业务做缓存以及查问题等。名字服务是少有的使用第三方开源组件实现的，用了zookeeper，这个东西我还不太了解。</p>
<p>在这方面，我还需要多加努力，很多东西都是一知半解。</p>
</li>
<li>
<p>在业务架构方面，我主要熟悉了微信消息系统、群、关系链、朋友圈、互通系统的架构设计，其中使用到的分布式seq算法和各种容灾策略，以及微信的多idc架构，这些让我受益匪浅，因为这样的机会很难得，这是一套能支撑起十亿人使用的业务架构，放在全球也是很少的。不过其实已经很成熟了，对于新人来说，有一个很大的缺点是熟悉了业务之后，会明显感受到成长缓慢，因为平时的工作内容大多还是在原来的基础上做需求，它的业务性质就已经决定了，可用性高于一切，不管是项目或者发布，都得为了可用性考虑，所以架构上基本不可能再改变。</p>
</li>
<li>
<p>其他的便是一些比较琐碎的了，比如编码规范，主要阅读了googleC++的编码规范，以及一些文档，比如protobuf的官方文档，语言方面主要读了《Effective modern C++》。</p>
</li>
</ol>
<p>这里的总结其实应该算是从正式入职截止到去年8月份一年多，因为女朋友实习完后也没有在广州找到合适的，最后还是去了深圳，每周来回跑长期下去也不是一个办法，再加上一些其他原因，我选择了活水到深圳。这段经历对我来说收获颇丰，开阔了我的眼界，也学习到了不少东西，也需要花不少时间去消化总结；认识到的同事也都很好，昨年上半年还拿了不错的绩效，其实还真的不太舍得。</p>
<p>随后到了深圳，终于不用每周末再来回奔波了，不过房价真的比广州贵太多。也就是昨年下半年。</p>
<p>主要学习到的是搜索相关的后台架构，以前对搜索引擎的工作机制不太了解，现在算是有了一个大致的轮廓了。对于工程来说，有几点是可以发力的，分布式爬虫（不过我们这边不算通用搜索，没有爬虫），在线召回（主要是求交算法的优化），离线索引（索引的管理与压缩），我的工作内容偏业务一点，主要是引擎的使用方，不过也需要去掌握引擎的原理。搜索系统对性能比较敏感，对耗时的要求很高，就算是业务方，也需要做不少优化工作。并且相比于普通业务来说，搜索业务相对复杂，一些工具的使用也更多一些，比如查性能瓶颈以及内存泄漏和越界等，这些让我在定位和调优工具的使用上有所提升。</p>
<h3 id="总结">总结</h3>
<p>以上是我对过去学到的东西以及过程的一些总结，里面没有什么太多实质性的内容，更多的是梳理。整体来说不算特别满意，主要是少了总结，比较零散，导致很多遗忘，这一点非常不好，后续我会做一些具体的整理。</p>
<p>之前读过一篇文章，里面提到技术人员的一些原则，其中有一点是“由始而终”，即先想清楚目标，再努力实现，学习也是一样，要带着目标去针对性学习，而不是零零散散东看一篇文章，西看一篇文章，知识要成体系，相辅相成，这很重要。</p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">ukeeysdis</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2021-01-03
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="http://ukeeysdis.github.io/tags/%E6%80%BB%E7%BB%93/">总结</a>
          
        </div>

      
      <nav class="post-nav">
        
        
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:ukeeysdis0526@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>


<a href="http://ukeeysdis.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2020 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        ukeeysdis
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  







  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script type="text/javascript">
    AV.initialize("2p1OP2x45bQLcU9pbVpyllQY-gzGzoHsz", "Iqoee8aoN1U3kD7fPfb6XlGe");
  </script>

  <script>
    function showHitCount(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push($(this).attr("id").trim());
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var hits = item.get('hits');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(hits);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function (results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("hits");
            counter.save(null, {
              success: function (counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('hits'));
              },
              error: function (counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
             
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
             
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("hits", 1);
            newcounter.save(null, {
              success: function (newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('hits'));
              },
              error: function (newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function (error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function () {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        
        addCount(Counter);
      } else if ($('.post-link').length > 1) {
        
        showHitCount(Counter);
      }
    });
  </script>









</body>
</html>
